<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>English Interactive - Le Monde des Curieux</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="images/favicon.png">
    
    <!-- CSS existants (ordre standard) -->
    <link rel="stylesheet" href="styles/style.css">
    <link rel="stylesheet" href="styles/index_style.css">
    <link rel="stylesheet" href="styles/menu_lateral_enhanced.css">
    <link rel="stylesheet" href="styles/accessibilite.css">
    <link rel="stylesheet" href="styles/dark-mode.css">
    <link rel="stylesheet" href="styles/breadcrumb.css">
    <link rel="stylesheet" href="styles/layout_style.css">
    <link rel="stylesheet" href="styles/general_style.css">
    <link rel="stylesheet" href="styles/components.css">
    
    <!-- CSS Section Anglais -->
    <link rel="stylesheet" href="styles/sections/english-interactive.css">
    <link rel="stylesheet" href="styles/duolingo-shared.css">
    
    <!-- Police Minecraft -->
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
</head>
<body class="english-interactive-section">
    
    <!-- Header stylis√© -->
    <header class="section-header-styled english">
        <div class="header-left">
            <button onclick="window.location.href='index.html'" class="back-btn-minecraft english">
                ‚Üê Accueil
            </button>
            <button onclick="window.location.href='english_duolingo_section.html'" class="mode-switch-btn">
                üìñ Mode Classique
            </button>
        </div>
        
        <div class="header-center">
            <h1>üá¨üáß English Interactive</h1>
        </div>
        
        <div class="header-right">
            <!-- Placeholder pour futures options -->
        </div>
    </header>

    <!-- Zone Duolingo Header -->
    <div class="duolingo-header">
        <div class="duolingo-header-container">
            <!-- Streak -->
            <div class="duolingo-stat streak">
                <div class="stat-icon">üî•</div>
                <div class="stat-content">
                    <div id="streak-display" class="stat-value">0 day</div>
                    <div class="stat-label">Streak</div>
                </div>
            </div>
            
            <!-- Hearts -->
            <div class="duolingo-stat hearts">
                <div class="stat-content">
                    <div id="hearts-display" class="stat-value">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</div>
                    <div class="stat-label">Hearts</div>
                </div>
            </div>
            
            <!-- XP -->
            <div class="duolingo-stat xp">
                <div class="stat-icon">‚≠ê</div>
                <div class="stat-content">
                    <div id="xp-display" class="stat-value">
                        Level 1 ‚Ä¢ 0 XP
                        <div class="xp-bar">
                            <div class="xp-progress" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Conteneur principal -->
    <main class="english-interactive-main">
        
        <!-- Banni√®re nouveau mode (visible depuis english_section.html) -->
        <div class="new-mode-banner" id="new-mode-banner" style="display: none;">
            <div class="banner-content">
                <div class="banner-icon">üéÆ</div>
                <div class="banner-text">
                    <strong>Nouveau Mode Interactif !</strong>
                    <p>Apprends l'anglais avec prononciation audio, exercices vari√©s et syst√®me de progression</p>
                </div>
                <button class="banner-close" onclick="document.getElementById('new-mode-banner').style.display='none'">
                    ‚úï
                </button>
            </div>
        </div>
        
        <!-- S√©lecteur de le√ßons -->
        <section id="lesson-selector" class="lesson-selector-section">
            <div class="section-intro">
                <h2>Choisis une le√ßon</h2>
                <p>Progresse √† ton rythme √† travers 20 le√ßons interactives !</p>
            </div>
            
            <!-- Le√ßons inject√©es dynamiquement par english-interactive.js -->
            <div class="lessons-loading">
                <div class="loading-spinner">‚è≥</div>
                <p>Chargement des le√ßons...</p>
            </div>
        </section>
        
        <!-- Zone de le√ßon active -->
        <section id="lesson-container" class="lesson-container-section">
            <!-- Contenu inject√© dynamiquement -->
        </section>
        
    </main>

    <!-- Footer -->
    <footer class="english-footer">
        <div class="footer-content">
            <p>¬© 2026 Le Monde des Curieux - Apprends l'anglais en t'amusant !</p>
            <div class="footer-links">
                <a href="index.html">Accueil</a>
                <a href="english_section.html">Mode Classique</a>
                <a href="#" onclick="window.englishApp?.loadProgress(); return false;">Rafra√Æchir Progression</a>
            </div>
        </div>
    </footer>

    <!-- Scripts Core (ordre d'importance) -->
    <!-- 1. Event Bus (doit √™tre charg√© en premier) -->
    <script src="scripts/core/event-bus.js"></script>
    
    <!-- 2. Storage Adapter -->
    <script src="scripts/core/storage-adapter.js"></script>
    
    <!-- 3. Audio Player -->
    <script src="scripts/core/audio-player.js"></script>
    
    <!-- 4. XP System Unified -->
    <script src="scripts/shared/xp-system-unified.js"></script>
    
    <!-- 5. Duolingo Mechanics (Hearts + Streaks) -->
    <script src="scripts/shared/duolingo-mechanics.js"></script>
    
    <!-- 6. Lesson Engine Universal (si utilis√©) -->
    <!-- <script src="scripts/lesson-engine.js"></script> -->
    
    <!-- 7. Controller Section Anglais -->
    <script src="scripts/sections/english/english-interactive.js"></script>
    
    <!-- Scripts g√©n√©raux du site -->
    <script src="scripts/general_script.js"></script>
    
    <!-- Script initialisation page -->
    <script>
        // V√©rification d√©pendances critiques
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üá¨üáß English Interactive Page Loading...');
            
            // V√©rification chargement Event Bus
            if (!window.eventBus) {
                console.error('‚ùå Event Bus not loaded!');
                document.querySelector('.lessons-loading').innerHTML = `
                    <div class="error-state">
                        <p>‚ö†Ô∏è Erreur de chargement des syst√®mes</p>
                        <button onclick="location.reload()">Rafra√Æchir</button>
                    </div>
                `;
                return;
            }
            
            // V√©rification Storage Adapter
            if (!window.storageAdapter) {
                console.error('‚ùå Storage Adapter not loaded!');
                return;
            }
            
            // V√©rification Audio Player
            if (!window.audioPlayer) {
                console.warn('‚ö†Ô∏è Audio Player not loaded, pronunciation may not work');
            }
            
            // V√©rification XP System
            if (!window.xpSystemUnified) {
                console.error('‚ùå XP System not loaded!');
                return;
            }
            
            // V√©rification Duolingo Mechanics
            if (!window.HeartSystem || !window.StreakSystem) {
                console.warn('‚ö†Ô∏è Duolingo Mechanics not fully loaded');
            }
            
            // V√©rification EnglishApp initialis√©
            const checkAppReady = setInterval(() => {
                if (window.englishApp) {
                    console.log('‚úÖ English Interactive App Ready!');
                    clearInterval(checkAppReady);
                    
                    // Log √©tat initial pour debug
                    console.log('Initial State:', {
                        lessons: window.englishApp.lessons.length,
                        hearts: window.englishApp.hearts?.getCurrentHearts(),
                        streak: window.englishApp.streaks?.getCurrentStreak(),
                        xp: window.englishApp.xp?.getSectionStats('anglais')
                    });
                }
            }, 100);
            
            // Timeout s√©curit√©
            setTimeout(() => {
                clearInterval(checkAppReady);
                if (!window.englishApp) {
                    console.error('‚ùå English App failed to initialize');
                    document.querySelector('.lessons-loading').innerHTML = `
                        <div class="error-state">
                            <p>‚ö†Ô∏è Impossible de d√©marrer l'application</p>
                            <button onclick="location.reload()">Rafra√Æchir</button>
                        </div>
                    `;
                }
            }, 5000);
        });
        
        // Helper: Affichage banni√®re si venu depuis english_section.html
        if (document.referrer.includes('english_section.html')) {
            const banner = document.getElementById('new-mode-banner');
            if (banner) {
                banner.style.display = 'block';
                
                // Auto-masquage apr√®s 10 secondes
                setTimeout(() => {
                    banner.style.display = 'none';
                }, 10000);
            }
        }
    </script>
</body>
</html>

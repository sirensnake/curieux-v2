<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sélection de l'Avatar - Le Monde des Curieux</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles/avatar-selection.css">
    
    <style>
        :root {
            --mc-green: #4aa52e;
            --mc-dark-green: #387a22;
            --pixel-border: 4px solid #000;
        }
    </style>
</head>
<body style="background: #2c3e50; font-family: 'Press Start 2P', cursive; color: white; display: flex; flex-direction: column; align-items: center; padding: 50px 20px;">

    <h1>CHOISIS TON CURIO</h1>

    <div class="avatar-grid" id="avatar-grid"></div>

    <button onclick="window.location.href='index.html'" 
            style="margin-top: 30px; padding: 15px; background: #866043; border: 4px solid #000; color: white; font-family: 'Press Start 2P'; cursor: pointer;">
        RETOUR AU MONDE
    </button>

    <script>
        const curioAvatars = [
            { id: 'curio_1', name: 'Explorateur', img: 'assets/img/avatars/explorer.png' },
            { id: 'curio_2', name: 'Scientifique', img: 'assets/img/avatars/scholar.png' },
            { id: 'curio_3', name: 'Maître Goupil', img: 'assets/img/avatars/fox.png' }
        ];
    </script>

    <script src="scripts/modules/reporting.js"></script>
    <script src="scripts/core/profile-manager.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const grid = document.getElementById('avatar-grid');
            
            // On utilise l'instance globale créée dans profile-manager.js
            if (!window.profileManager) {
                console.error("Erreur : profileManager n'est pas chargé.");
                return;
            }

            const currentId = window.profileManager.currentAvatar;

            curioAvatars.forEach(avatar => {
                const card = document.createElement('div');
                card.className = `avatar-card ${avatar.id === currentId ? 'active' : ''}`;
                
                // Image avec fallback si le fichier local est manquant
                const fallback = `https://api.dicebear.com/7.x/pixel-art/svg?seed=${avatar.id}`;

                card.innerHTML = `
                    <img src="${avatar.img}" class="avatar-img" onerror="this.src='${fallback}'">
                    <div class="avatar-name">${avatar.name}</div>
                `;

                card.onclick = () => {
                    window.profileManager.setAvatar(avatar.id);
                    // Mise à jour visuelle des bordures (classe active)
                    document.querySelectorAll('.avatar-card').forEach(c => c.classList.remove('active'));
                    card.classList.add('active');
                };

                grid.appendChild(card);
            });
        });
    </script>
</body>
</html>